(function () {
    var pluginManager = tinymce.util.Tools.resolve('tinymce.PluginManager');

    var dialogConfig = {
        title: 'Insert image template',
        body: {
            type: 'panel',
            items: [{
                type: 'input',
                name: 'imageData',
                label: 'Enter image url with name, i.e. /2020/spfx-azfunc-pnp-core/Apis.png'
            },
            {
                type: 'checkbox',
                name: 'setWidth',
                label: 'Set width to 800px?'
            }]
        },
        buttons: [
            {
                type: 'cancel',
                name: 'closeButton',
                text: 'Cancel'
            },
            {
                type: 'submit',
                name: 'submitButton',
                text: 'Insert',
                primary: true
            }
        ],
        initialData: {
            imageData: '',
            setWidth: true
        },
        onSubmit: function (api) {
            var data = api.getData();

            var html = '<p><a href="/image.axd?picture=' + data.imageData + '" class="colorbox cboxElement"><img style="display: block; margin-left: auto; margin-right: auto;" src="/image.axd?picture=' + data.imageData + '" ' + (data.setWidth ? 'width="800"' : '') + '></a></p>';
            console.log(html);
            tinymce.activeEditor.execCommand('mceInsertContent', false, html);

            api.close();
        }
    };

    var setupButtons = function (editor) {
        editor.ui.registry.addButton('customimage', {
            icon: 'gallery',
            onAction: function () {
                editor.windowManager.open(dialogConfig)
            }
        })
    };

    pluginManager.add('customimage', function (editor) {
        setupButtons(editor);
    });

})();